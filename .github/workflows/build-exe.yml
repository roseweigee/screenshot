name: Build Windows EXE

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-exe:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: Download ChromeDriver
      run: |
        $response = Invoke-RestMethod -Uri "https://chromedriver.storage.googleapis.com/LATEST_RELEASE"
        $version = $response.Trim()
        $url = "https://chromedriver.storage.googleapis.com/$version/chromedriver_win32.zip"
        
        Write-Host "下載 ChromeDriver 版本: $version"
        Invoke-WebRequest -Uri $url -OutFile "chromedriver.zip"
        Expand-Archive -Path "chromedriver.zip" -DestinationPath "."
        Remove-Item "chromedriver.zip"
    
    - name: Build executable
      run: |
        pyinstaller --onefile --console --name="WebScreenshot" --add-data="chromedriver.exe;." screenshot_app.py
    
    - name: Upload executable
      uses: actions/upload-artifact@v4
      with:
        name: WebScreenshot-Windows-EXE
        path: dist/WebScreenshot.exe
        retention-days: 30
